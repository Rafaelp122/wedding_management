<div class="bg-white p-4 rounded-4 aba-bloco custom-shadow-lg">
  
  <h3 class="fs-4 fw-bold text-dark mb-4">Contratos do Casamento</h3>

  {% if contracts_list %}
    <div class="table-responsive">
      <table class="table align-middle">
        
        <thead class="table-light thead-custom-color">
          <tr>
            <th scope="col">Fornecedor</th>
            <th scope="col">Item</th>
            <th scope="col">Data da Criação</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for item in contracts_list %}
            
            {% with contract=item.contract %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="rounded-circle d-flex align-items-center justify-content-center text-white fw-bold me-3" 
                       style="width: 40px; height: 40px; background: {{ item.gradient }};">
                    <!-- CORREÇÃO: Removido .name (supplier já é o texto) -->
                    {{ contract.supplier|slice:":1"|default:"-" }}
                  </div>
                  <!-- CORREÇÃO: Removido .name aqui também -->
                  <div>{{ contract.supplier|default:"N/A" }}</div>
                </div>
              </td>
              <td>{{ contract.item.name|default:"N/A" }}</td>
              <td>{{ contract.created_at|date:"d/m/Y" }}</td>
              <td>
                {% if contract.status == "COMPLETED" %}
                  <span class="badge rounded-pill bg-success-subtle text-success-emphasis">Concluído</span>
                {% elif contract.status == "WAITING_PLANNER" %}
                  <span class="badge rounded-pill bg-warning-subtle text-warning-emphasis">Aguardando Você</span>
                {% elif contract.status == "WAITING_SUPPLIER" %}
                  <span class="badge rounded-pill bg-info-subtle text-info-emphasis">Aguardando Fornecedor</span>
                {% elif contract.status == "WAITING_COUPLE" %}
                  <span class="badge rounded-pill bg-primary-subtle text-primary-emphasis">Aguardando Noivos</span>
                {% else %}
                  <span class="badge rounded-pill bg-secondary-subtle text-secondary-emphasis">{{ contract.get_status_display }}</span>
                {% endif %}
              </td>
              <td class="text-nowrap">
                
                {% if contract.status != 'COMPLETED' %}
                    <button type="button" class="btn btn-link p-0 me-3" 
                            title="Coletar Assinatura" 
                            data-url="{% url 'contracts:generate_link' contract.id %}"
                            onclick="openSignatureModal(this)">
                        <i class="fas fa-paper-plane" style="background: var(--color-accent); -webkit-background-clip: text; background-clip: text; color: transparent;"></i>
                    </button>
                {% else %}
                    <span class="text-success me-3" title="Processo Finalizado"><i class="fas fa-check-circle"></i></span>
                {% endif %}

                <a href="{% url 'contracts:download_pdf' contract.id %}" target="_blank" class="btn btn-link p-0" title="Visualizar/Baixar Contrato">
                    {% if contract.status == 'COMPLETED' %}
                        <i class="fas fa-file-pdf text-danger fs-5"></i>
                    {% else %}
                        <i class="fas fa-file-alt text-secondary fs-5"></i>
                    {% endif %}
                </a>

              </td>
            </tr>
            {% endwith %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">Nenhum contrato foi gerado para este casamento ainda.</p>
  {% endif %}

</div>

{% include 'contracts/modals/signature_modal.html' %}