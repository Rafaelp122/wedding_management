{% extends 'base-apps.html' %}
{% load static %}
{% block page_title %} Meus Casamentos {% endblock %}

{% block page_styles %}
  <link rel="stylesheet" href="{% static 'weddings/css/list.css' %}">
{% endblock page_styles %}

{% block content %}
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold">Meus Casamentos</h2>
      <p class="text-muted">Gerencie todos os detalhes dos seus eventos</p>
    </div>

    <button class="btn btn-primary"
          hx-get="{% url 'weddings:create_wedding' %}"  
          hx-target="#modal-container"
          data-bs-toggle="modal"
          data-bs-target="#main-modal">
    + Novo Casamento
    </button>
  </div>

  <div class="row" id="wedding-list-container">
    {% for item in weddings_with_clients %}
      {% include 'weddings/partials/_wedding_card.html' with item=item %}
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info text-center">
          Você ainda não cadastrou nenhum casamento. 
          <a href="#" 
            class="link-primary fw-semibold"
            hx-get="{% url 'weddings:create_wedding' %}"  
            hx-target="#modal-container"
            data-bs-toggle="modal"
            data-bs-target="#main-modal">
            Clique aqui para adicionar
          </a>.
        </div>
      </div>
    {% endfor %}
  
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.body.addEventListener('click', function(e) {
    
    const cardWrapper = e.target.closest('.card-wrapper');

    if (!cardWrapper || e.target.closest('a') || e.target.closest('form')) {
      return;
    }

    const link = cardWrapper.getAttribute('data-href');
    if (link) {
      window.location.href = link;
    }
  });
</script>

<script>
  document.body.addEventListener('weddingCreated', function(evt) {
    const modalEl = document.getElementById('main-modal');
    if (modalEl) {
      const modalInstance = bootstrap.Modal.getInstance(modalEl);
      if (modalInstance) {
        modalInstance.hide(); 
      }
      
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach(b => b.remove());

      document.body.classList.remove('modal-open');
    }
  });
</script>

{% endblock %}
