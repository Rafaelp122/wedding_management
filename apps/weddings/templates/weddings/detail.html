{% extends 'base-apps.html' %}
{% load static %}

{% block page_title %} Detalhes do Casamento {% endblock %}

{% block page_styles %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'weddings/css/detail.css' %}">
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
{% endblock page_styles %}

{% block main_class %} wedding-detail-class {% endblock main_class %}

{% block content %}
<div class="container py-5">
  <a href="{% url 'weddings:my_weddings' %}" class="text-decoration-none text-purple mb-4 d-inline-block">
    <i class="bi bi-arrow-left"></i> Voltar para Meus Casamentos
  </a>

  <!-- Cabeçalho com nomes e data -->
  <div class="card shadow-lg-tailwind rounded-3 p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h4 class="fw-bold text-purple mb-1">
          {% if wedding.groom_name and wedding.bride_name %}
            {{ wedding.groom_name }} & {{ wedding.bride_name }}
          {% else %}
            Casamento sem nome definido
          {% endif %}
        </h4>
        <p class="text-muted">{{ wedding.date|date:"d \d\e F, Y" }} - {{ wedding.location }}</p>
      </div>
      <div>
        <a href="#" class="btn btn-outline-primary me-2">Exportar</a>
        <a href="#" class="btn btn-outline-secondary">Compartilhar</a>
      </div>
    </div>
  </div>

  <!-- Menu de Abas -->
  <ul class="abas-casamento nav" id="abasCasamento">
    <li class="nav-item">
      <a
        class="nav-link active"
        href="#"
        data-tab="budget"
        hx-get="{% url 'budget:partial_budget' wedding.id %}"
        hx-target="#tab-budget"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-coins me-2"></i> Orçamento
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        href="#"
        data-tab="contracts"
        hx-get="{% url 'contracts:partial_contracts' wedding.id %}"
        hx-target="#tab-contracts"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-file-contract me-2"></i> Contratos
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        href="#"
        data-tab="items"
        hx-get="{% url 'items:partial_items' wedding.id %}"
        hx-target="#tab-items"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-list-check me-2"></i> Itens
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link"
        href="#"
        data-tab="scheduler"
        hx-get="{% url 'scheduler:partial_scheduler' wedding.id %}"
        hx-target="#tab-scheduler"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-calendar-days me-2"></i> Calendário
      </a>
    </li>
  </ul>

  <!-- Conteúdo das Abas -->
  <div class="tab-content mt-4">
    <div id="tab-budget" class="tab-pane active"></div>
    <div id="tab-contracts" class="tab-pane d-none"></div>
    <div id="tab-items" class="tab-pane d-none"></div>
    <div id="tab-scheduler" class="tab-pane d-none"></div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabLinks = document.querySelectorAll('#abasCasamento .nav-link');
    const tabPanes = document.querySelectorAll('.tab-content .tab-pane');

    tabLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();

        tabLinks.forEach(l => l.classList.remove('active'));
        tabPanes.forEach(pane => {
          pane.classList.remove('active');
          pane.classList.add('d-none');
        });

        this.classList.add('active');
        const tabId = 'tab-' + this.dataset.tab;
        const content = document.getElementById(tabId);
        content.classList.remove('d-none');
        content.classList.add('active');
      });
    });

    // Carrega a primeira aba automaticamente
    tabLinks[0].click();
  });
</script>
{% endblock %}
