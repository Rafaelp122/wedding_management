{% extends 'base-apps.html' %}
{% load static %}

{% block page_title %} Detalhes do Casamento {% endblock %}

{% block page_styles %}
  <link rel="stylesheet" href="{% static 'weddings/css/detail.css' %}">
{% endblock page_styles %}

{% block main_class %} wedding-detail-class {% endblock main_class %}

{% block content %}
<div class="container py-4">
  <a href="{% url 'weddings:my_weddings' %}" class="btn btn-link p-0 text-decoration-none fw-medium mb-4 d-inline-block" style="color: #9C27B0;">
    <i class="fas fa-arrow-left me-2"></i> Voltar para Meus Casamentos
  </a>

  <div class="card custom-shadow-lg rounded-4 p-4 mb-4">
    <div class="d-flex flex-column flex-md-row align-items-md-center">
      
        <div class="d-flex align-items-center mb-3 mb-md-0 me-md-4">
            <div class="rounded-circle bg-gradient-primary d-flex align-items-center justify-content-center text-white fs-5 fw-bold me-3" style="width: 64px; height: 64px; flex-shrink: 0;">
                {% if wedding.groom_name and wedding.bride_name %}
                    {{ wedding.groom_name|slice:":1" }}&{{ wedding.bride_name|slice:":1" }}
                {% else %}
                    --
                {% endif %}
            </div>

            <div>
                <h4 class="fw-bold text-dark mb-0">
                  {% if wedding.groom_name and wedding.bride_name %}
                    {{ wedding.groom_name }} & {{ wedding.bride_name }}
                  {% else %}
                    Casamento sem nome definido
                  {% endif %}
                </h4>
                <p class="text-muted mb-0">{{ wedding.date|date:"d \d\e F, Y" }} - {{ wedding.location }}</p>
            </div>
        </div>

        <div class="ms-md-auto d-flex">
            <a href="#" class="btn btn-primary d-flex align-items-center me-3">
                <i class="fas fa-download me-2"></i> Exportar
            </a>
            <a href="#" class="btn btn-outline-primary d-flex align-items-center">
                <i class="fas fa-share-alt me-2"></i> Compartilhar
            </a>
        </div>
    </div>
  </div>

  <!-- Menu de Abas -->
  <ul class="abas-casamento nav" id="abasCasamento">
    <li class="nav-item">
      <a
        class="nav-link active"
        href="#"
        data-tab="budget"
        hx-get="{% url 'budget:partial_budget' wedding.id %}"
        hx-target="#tab-budget"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-coins me-2"></i> Orçamento
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link active"
        href="#"
        data-tab="contracts"
        hx-get="{% url 'contracts:partial_contracts' wedding.id %}"
        hx-target="#tab-contracts"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-file-contract me-2"></i> Contratos
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link active"
        href="#"
        data-tab="items"
        hx-get="{% url 'items:partial_items' wedding.id %}"
        hx-target="#tab-items"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-list-check me-2"></i> Itens
      </a>
    </li>
    <li class="nav-item">
      <a
        class="nav-link active"
        href="#"
        data-tab="scheduler"
        hx-get="{% url 'scheduler:partial_scheduler' wedding.id %}"
        hx-target="#tab-scheduler"
        hx-swap="innerHTML"
        hx-trigger="click"
      >
        <i class="fas fa-calendar-days me-2"></i> Calendário
      </a>
    </li>
  </ul>

  <!-- Conteúdo das Abas -->
  <div class="tab-content mt-4">
    <div id="tab-budget" class="tab-pane active"></div>
    <div id="tab-contracts" class="tab-pane d-none"></div>
    <div id="tab-items" class="tab-pane d-none"></div>
    <div id="tab-scheduler" class="tab-pane d-none"></div>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabLinks = document.querySelectorAll('#abasCasamento .nav-link');
    const tabPanes = document.querySelectorAll('.tab-content .tab-pane');

    tabLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();

        // Remove 'active' de todas as abas e esconde todos os painéis
        tabLinks.forEach(l => l.classList.remove('active'));
        tabPanes.forEach(pane => {
          pane.classList.remove('active');
          pane.classList.add('d-none');
        });

        // Adiciona 'active' à aba clicada e mostra o painel correspondente
        this.classList.add('active');
        const tabId = 'tab-' + this.dataset.tab;
        const content = document.getElementById(tabId);
        content.classList.remove('d-none');
        content.classList.add('active');
      });
    });

    // Dispara o clique (e o HTMX) na primeira aba ao carregar a página
    tabLinks[0].click();
  });
</script>
{% endblock extra_js %}
