{% comment %}
  ARQUIVO: items/partials/_item_card_actions.html
  Este partial renderiza o menu de 3 pontos (dropdown)
  para o card de item.

  Espera a variável 'item'.
{% endcomment %}
<div class="dropdown">
    {% comment %} O botão (os 3 pontos) que abre o menu {% endcomment %}
    <button class="btn btn-link text-muted p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="line-height: 1;">
        <i class="fas fa-ellipsis-v"></i>
    </button>
    
    {% comment %} A lista de opções do menu {% endcomment %}
    <ul class="dropdown-menu dropdown-menu-end">
        <li><h6 class="dropdown-header">Ações do Item</h6></li>
        
        {% comment %} 
          Ação ATUALIZAR (GET): 
          - hx-get: Busca o formulário de edição na view 'edit_item'.
          - hx-target: O alvo é '#items-wrapper' (o container inteiro).
          - hx-swap: Substitui o container inteiro pelo formulário.
        {% endcomment %}
        <li><a class="dropdown-item" href="#"
               hx-get="{% url 'items:edit_item' item.pk %}"
               hx-target="#items-wrapper"
               hx-swap="outerHTML">
            <i class="fas fa-pencil-alt fa-fw me-2"></i> Atualizar
        </a></li>
        
        {% comment %} 
          Ação DELETAR (POST):
          - hx-post: Envia um POST para a view 'delete_item'.
          - hx-vals: Inclui o CSRF token necessário para o POST.
          - hx-target/hx-swap: Substitui o container pela lista atualizada.
          - hx-confirm: Mostra um pop-up de confirmação.
        {% endcomment %}
        <li><a class="dropdown-item" href="#"
               hx-post="{% url 'items:delete_item' item.pk %}"
               hx-vals='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'
               hx-target="#items-wrapper"
               hx-swap="outerHTML"
               hx-confirm="Tem certeza que deseja excluir o item '{{ item.name }}'?">
            <i class="fas fa-trash-alt fa-fw me-2 text-danger"></i> Deletar
        </a></li>
        
        <li><hr class="dropdown-divider"></li>
        <li><h6 class="dropdown-header">Mudar Status</h6></li>
        
        {% comment %} 
          Ação MUDAR STATUS (POST):
          - hx-post: Envia um POST para a view 'update_status'.
          - hx-vals: Envia o novo 'status' E o 'csrf_token'.
          - hx-target/hx-swap: Substitui o container pela lista atualizada.
        {% endcomment %}
        {% if item.status != 'PENDING' %}
            <li><a class="dropdown-item" href="#"
                   hx-post="{% url 'items:update_status' item.pk %}"
                   hx-vals='{"status": "PENDING", "csrfmiddlewaretoken": "{{ csrf_token }}"}'
                   hx-target="#items-wrapper"
                   hx-swap="outerHTML">
                <i class="fas fa-exclamation-circle fa-fw me-2 text-info"></i> Pendente
            </a></li>
        {% endif %}
        {% if item.status != 'IN_PROGRESS' %}
            <li><a class="dropdown-item" href="#"
                   hx-post="{% url 'items:update_status' item.pk %}"
                   hx-vals='{"status": "IN_PROGRESS", "csrfmiddlewaretoken": "{{ csrf_token }}"}'
                   hx-target="#items-wrapper"
                   hx-swap="outerHTML">
                <i class="fas fa-spinner fa-fw me-2 text-warning"></i> Em Andamento
            </a></li>
        {% endif %}
        {% if item.status != 'DONE' %}
            <li><a class="dropdown-item" href="#"
                   hx-post="{% url 'items:update_status' item.pk %}"
                   hx-vals='{"status": "DONE", "csrfmiddlewaretoken": "{{ csrf_token }}"}'
                   hx-target="#items-wrapper"
                   hx-swap="outerHTML">
                <i class="fas fa-check-circle fa-fw me-2 text-success"></i> Concluído
            </a></li>
        {% endif %}
    </ul>
</div>
